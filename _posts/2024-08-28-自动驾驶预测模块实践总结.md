---
date: 2024-08-28 15:11:26
layout: post
title: 自动驾驶预测模块实践总结
subtitle: '自动驾驶预测模块实践总结'
description: 自动驾驶
category: 自动驾驶
image: /post_images/auto_drive/自动驾驶预测模块-封面.png
tags:
  - 自动驾驶
  - 轨迹预测
  - 行为预测
  - 决策规划
author: 沙中世界
---
### 预测模块存在的价值和必要性
预测模块不是为了存在而存在，早期的一些辅助驾驶功能，如：跟车自适应巡航，没有预测模块也是可以达到效果预期的。

随着对辅助驾驶功能要求逐步提高，需要在更复杂的工况下，完成安全、舒适、高效的控车，对周边交通参与者的意图以及未来轨迹有更准确的了解与把握成为必要条件之一，预测模块主要功能就是对周边交通参与者的意图&轨迹进行预测；

case1：早期ACC策略，主要关注前车速度和跟车距离，当面临前车因为前方路况突然切出时，自车很可能响应不及时；如果能提前预测出前车切出，则可以更早的将关注点放到前车前方，争取更多的时间；

case2：泊车业务第一版，针对行人策略时划定一个危险区域，只要区域内有行人，就刹停；<br>
      进阶版：可以准确识别动静，如果静态障碍物则选择是否绕障碍，如果时动态障碍物，则刹停；<br>
      再次进阶：针对动态障碍物，区分沿途和横穿，针对横穿目标刹停，针对沿途目标进行绕障或者直行；
      再次进阶：针对横穿目标，结合轨迹进行强让决策；

核心点在于：自动驾驶是一项系统工程，目标是实现安全、舒适、高效的控车，预测模块是系统工程的一环，预测的目标是配合决策规划模块完成系统工程的目标；

常见误区：
- 过分追求和强调模块级目标（如：ADE、FDE），忽略系统效果；
- 把系统效果问题局限于预测模块内部解决，忽略上下游的配合；<br>
  如：切入误判的情况下，可以配合caution机制协作完成舒适控车；

### 最佳实践
#### 正向迭代的保障工具链
基本逻辑是实现仿真 → 可视化 → 效果评测功能；整套工具链从能用 → 易用、好用、高效 → 真正的赋能方案迭代，保证效果；<br>
功能层面的仿真、可视化、评测只是冰山表面上的东西，更深层次有以下两个几个因素：

① 数据分布、数据有效性（去除上游问题数据、陈旧的数据，比如：参考线信息的增加）、数据标注质量；<br>
② 评测指标的合理性、完备性；（横向FDE，跳变次数，最早触发时刻、轨迹异常）<br>
③ 持续关注、提升易用性和效率的意识；比如：快速精准定位时间戳、目标筛选、自定义对比颜色、轨迹时长、真值显示、覆盖式显隐等

典型案例：目标加速度系数的调整；

#### 由rule base到learning base的转型
![learning预测架构](/post_images/auto_drive/learning预测架构.jpg)


### rule base开发的本质
① 不断的寻找、发现新的划分维度<br>
② 寻找不同维度的最佳切分点

扩展维度的一些思路：<br>
某一维度 + 时间维度，扩展出变化趋势的维度（加速度、yaw rate等；很多问题，根据某一时刻下的空间位置信息很难分析解决，但如果根据连续的一段时间的空间位置数据，就能得到更多有效信息）；

相同维度，不同实体之间的差值对比；（比如：目标走向和车道线走向的夹角；某一动态目标和静态目标的相对位置关系；时距差值）

不同维度之间的计算关系：距离 + 速度 → 时距; 距离 + 当前速度 + 碰撞点 → 减速度

### 做好预测的关键要素

** 数据驱动策略 **

** 效率工具 **

** 流程 **
技术方案评审<br>
code review<br>
仿真评测<br>

### deeplearning的方法综述
以2020年为分割线，2020之前主要以图像领域的深度学习技术进行轨迹预测，对Image进行栅格化，基于CNN算子进行编码 - 解码；<br>
2020年，vector net论文提出向量方式对输入进行编码，这种方式逐步成为主流，并且逐步应用attention机制进行编码和解码；
