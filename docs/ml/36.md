行为检测综述
====
## 背景
预测主车周边的物体（行人、自行车、其他车辆等）在未来一段时间的运行轨迹，对于主车的规划、决策是至关重要的；<br>
考虑到目前端到端的自动驾驶还不能支撑量产需求，在量产车落地上，还是将自动驾驶划分为：感知、规划、决策三个主要阶段，其中行为预测属于感知的一个子任务；<br>
对上承接感知层面的一些输出，如：物体的类型、bound box、历史轨迹、速度、加速度、角速度等；<br>
结合地图信息、车道线、红绿灯等<br>
输出每一个物体在未来一小段时间内（通常是10秒左右）的运动轨迹；<br>

## 任务
利用感知信息融合地图信息，预测物体未来一段时间的轨迹（坐标）；<br>
输入：<br>
- 感知信息：物体类型、bound box、位置、速度、角速度、加速度、红绿灯状态、周边其他物体信息、车道线信息
- 地图信息：周边建筑物信息（如：停车场）、车道线信息等

输出：<br>
- 物体未来10秒左右的运动轨迹

## 解决方案
### 运动学模型
加速度对时间的积分是速度变化，速度对时间的积分是位移；

### 意图模型
利用交通规则等信息，识别物体的意图，进而预测其轨迹，比如：遇见红绿灯要停车，拐弯要减速等；

### 交互模型
考虑主车与周围环境的交互，比如：识别其他物体的意图（比如：判断旁边车辆是否要变道等），根据其他物体的意图来预测主车轨迹；

### 深度学习（RNN模型）

### 基于GAN的行为预测（S-GAN）

### PECNet & R-PECNe

### Trajectron++*


## 评价指标
### ADE
所有时刻的位移误差，求平均值；（求平均值时，分母为：物体数量 × 时刻数量）

### FDE
只看最终时刻的位移误差，求平均值；（分母为：物体数量）

## 开源数据集
### ETH数据集
https://paperswithcode.com/dataset/eth<br>
采用鸟瞰视角采集的固定位置的视频数据，视频中内容为行人运动，没有车辆；<br>
**单应性矩阵：** 解决同一物理世界对应不同视角图像的坐标系之间的变换的一个矩阵；<br>
预测方案：https://github.com/HarshayuGirase/Human-Path-Prediction

### UCY数据集

### SDD数据集

## 论文解读
[From Goals, Waypoints & Paths To Long Term Human Trajectory Forecasting](https://arxiv.org/pdf/2012.01526.pdf)<br>
基于目标、历史轨迹、道路对行人轨迹进行长期预测；<br>
给定一个场景以及物体在这个场景下过去5秒的运动轨迹，预测未来1分钟内可能的一个或者多个运行轨迹<br>
**问题分析** <br>
通常路径预测会从两个重要依据出发：<br>
1. 基于认知理解的预测；（比如：分析行人的目的地，然后预测路径）；<br>
2. 基于历史轨迹和道路信息预测所有可能的走法<br>
论文中提出了Y-NET网络，可以平衡这两种信息依据；<br>

即使在知道目标的前提下，也不一定能够准确预测轨迹，仍然需要考虑很多的环境因素，比如：是否等红绿灯，是否避让他人，绿灯是否即将变红灯等，甚至人的目标也有可能是随时变换的，所以即使环境相同，但人的目标有变化后，轨迹依然会有所不同；

所以面临的任务，无论是对行人目标的意图理解，还是外部环境都是有不确定性的；

**建模思路** <br>
首先根据场景图（RGB图像）与用户的历史轨迹，对轨迹的终点分布情况进行预测（也就是1分钟后大概会在什么位置）；这一阶段主要解决认知不确定性<br>
然后基于场景图情况，结合上面预测的终点，随机选取可能的路径点；这一阶段解决受环境影响的不确定性<br>

**过去相关工作** <br>
模型输入：历史轨迹、场景图、行人姿势、分割后语义线索、位置信息、其他行人信息、车辆信息、信号灯、目的地；<br>
分类：从行人视角结合姿势信息等预测固定的轨迹、利用生成式模型思路生成模型轨迹、数字概率估计(比如：估计到达每一个像素/网格的概率)<br>
**Y-NET网络介绍** <br>

**损失函数** <br>
BCEWithLogitsLoss = Sigmoid + BCELoss；<br>
论文中损失函数有三部分，在Y-net中，损失函数有两部分，加权求和，先说标签：<br>
标签1：目标点，会用get_patch函数转为一张图；跟Ug解码的输出计算损失<br>
标签2：轨迹点，会用get_patch函数转为一张图；跟Ut解码的输出计算损失<br>



## 参考资料
2014年论文：https://hal.inria.fr/hal-01053736/document 附论文解读：https://zhuanlan.zhihu.com/p/158951141<br>
2019年论文：https://arxiv.org/pdf/1912.11676.pdf 附论文解读：https://blog.csdn.net/weixin_35448535/article/details/112585397<br>
2020年，基于深度学习的方法综述：http://kzyjc.alljournals.cn/kzyjc/article/abstract/2020-1841<br>
2020年，https://arxiv.org/pdf/2012.01526.pdf<br>
行人检测+路径预测：https://github.com/YapingZ/Pedestrian-behavior-trajectory-prediction


