hadoop
====
官方文档：http://hadoop.apache.org/docs/stable/index.html
### 常见版本及其区别
Apache hadoop 最原始版本

Cloudera的CDH版本

Hortonworks版本（HDP）

### 安装
#### Apache版本
首先记得改hosts文件：实际ip地址:主机名

各个机器之间配置SSH免密登录

#### CDH版本

### HADOOP组件
主要由hadoop-common、hadoop-hdfs、map-reduce、yarn四部分构成

### HADOOP-COMMON
hdfs和mapreduce的公共库

### HADOOP-HDFS
由namenode、secondaryNamenode、datanode进程构成，其结构图如下：<br>
![hadoop-hdfs结构图](/docs/bigData/images/1-1.jpg)

HDFS文件系统对外暴露文件的层级结构（类似于linux文件系统），然而在内部是以block序列存储的，即一个文件被分为多个block存储于多个datanode节点上。

**namenode进程**<br>
HDFS类似主从（master/slave）架构，一个集群中只有一个nameNode进程，其角色类似于master；主要负责对外展示文件的层级结构、管理客户端对文件的访问，如：打开、关闭、重命名等、决定文件的block与datanode之间的映射关系。

nameNode进程相关信息都会记录在FsImage和editlog两个文件中，可以通过配置保持一份或者多份同步更新，在某个节点失败之后，只要文件存在便可以迅速恢复。

关于权限控制，与linux系统有很大相似之处，可以通过chown命令修改相关文件夹、文件的权限。FS客户端一般取客户端进程所在主机名作为用户名。超级用户是运行nameNode进程的用户。参考：http://hadoop.apache.org/docs/r1.0.4/cn/hdfs_permissions_guide.html#Shell%E5%91%BD%E4%BB%A4%E5%8F%98%E6%9B%B4

**secondaryNamenode**

**datanode**<br>
一个集群中有多个dataNode，通常每台机器部署1个。主要负责数据存储、处理来自客户端的读写请求等（包括block的创建删除）。

DataNode节点的启动很简单，拷贝NameNode节点配置，在danaNode节点执行：./sbin/hadoop-daemon.sh start datanode

副本的存储配置时hdfs系统的优化重点，直接关系到集群的可靠性和性能（如一个文件的两个副本与文件存储在同一个机器上，则很难起到备份作用）；受硬件布局、带宽等很多因素影响。

### MAP-REDUCE

### YARN
YARN是集群资源管理的组件，主要有resourceManager和nodeManager进程构成。前者负责各个Application的资源分配，后者负责各自节点的CPU、内存、硬盘、网络等的监控，并负责报告给resourceManager进程。结构图如下：<br>
![YARN结构图](/docs/bigData/images/1-2.jpg)<br>

resourceManager由两部分构成，scheduler和applicationManager

scheduler仅负责资源分配，支持不同的调度策略如：CapacityScheduler，FairScheduler。并不处理application的相关消息，也不关注application的状态等。<br>
application向applicationManager提交任务，由applicationManager向scheduler申请资源，之后负责启动容器，选取applicationMaster，并且提供一些容错机制，如applicationMaser失败之后重试等

Nodemanager启动

yarn-site.xml配置：``` yarn.resourcemanager.resource-tracker.address ```,确保nodemanager可以找到resourcemanager;执行：``` ./sbin/yarn-daemon.sh start nodemanager ```

### 认证机制
#### kerberos认证机制
通过Principal（类似于用户名）+keytab文件（类似于秘钥）<br>
配置方式一，启动java程序是增加如下属性配置：
>-Dhadoop.property.hadoop.security.authentication=kerberos<br>
-Dhadoop.property.hadoop.client.keytab.file=/home/panteng.keytab<br>
-Dhadoop.property.hadoop.client.kerberos.principal=panteng@XXX.HADOOP

配置方式二，在core-site.xml中增加如下配置：<br>
```xml
  		<property>
    			<name>hadoop.security.authentication</name>
    			<value>kerberos</value>
  		</property>
  		<property>
    			<name>hadoop.client.kerberos.principal</name>
    			<value>panteng@XXX.HADOOP</value>
  		</property>
  		<property>
    			<name>hadoop.client.keytab.file</name>
    			<value>path/panteng.keytab</value>
  		</property>
```

### 高可用
常见的故障一般为namenode节点挂掉、数据节点挂掉、网络故障等（网络隔离，不通）。

高可用参考资料：https://blog.csdn.net/liu123641191/article/details/80737761

### 其他
通过Reservation System实现资源预订机制，可确保重要任务有足够可用资源。

通过YARN Federation 实现资源扩容与缩放
